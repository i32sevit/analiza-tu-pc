<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>AnalizaPC</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      padding: 20px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      min-height: 100vh;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255,255,255,0.1);
      padding: 30px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    h1 { 
      text-align: center; 
      margin-bottom: 30px;
      font-size: 2.5em;
    }
    button { 
      padding: 15px 30px; 
      font-size: 18px; 
      margin: 20px 0; 
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      transition: background 0.3s;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    pre { 
      background: rgba(0,0,0,0.3); 
      padding: 20px; 
      border-radius: 8px; 
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      max-height: 400px;
      overflow-y: auto;
    }
    .url-box {
      background: rgba(255,255,255,0.2);
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üñ•Ô∏è AnalizaPC</h1>
    <button id="btn">üîç Detectar y analizar hardware</button>
    <pre id="out">Presiona el bot√≥n para comenzar el an√°lisis de tu sistema...</pre>
  </div>

  <script>
    const si = require('systeminformation');
    const axios = require('axios');

    const out = document.getElementById('out');
    const btn = document.getElementById('btn');

    btn.onclick = async () => {
      btn.disabled = true;
      out.innerText = 'üîÑ Detectando hardware...\n\nPor favor espera, esto puede tomar unos segundos.';
      
      try {
        // Recopilar informaci√≥n del sistema
        out.innerText = 'üîç Obteniendo informaci√≥n de CPU...';
        const cpu = await si.cpu();
        
        out.innerText += '\nüîç Obteniendo informaci√≥n de RAM...';
        const mem = await si.mem();
        
        out.innerText += '\nüîç Obteniendo informaci√≥n de almacenamiento...';
        const disk = await si.diskLayout();
        
        out.innerText += '\nüîç Obteniendo informaci√≥n de GPU...';
        const graphics = await si.graphics();
        const gpu = graphics.controllers[0] || {};
        
        const data = {
          cpu_model: cpu.brand,
          cpu_speed_ghz: parseFloat(cpu.speed) || 1.0,
          cores: cpu.cores || 1,
          ram_gb: +(mem.total / (1024**3)).toFixed(2),
          disk_type: disk[0] ? disk[0].type : 'UNKNOWN',
          gpu_model: gpu.model || '',
          gpu_vram_gb: gpu.vram ? gpu.vram/1024 : 0
        };

        out.innerText = 'üìä Datos del sistema detectados:\n' + JSON.stringify(data, null, 2) + 
                       '\n\nüîÑ Enviando al servidor para an√°lisis...';

        // Enviar al backend
        const res = await axios.post('http://localhost:8000/api/analyze', data);
        
        let resultText = '‚úÖ ¬°An√°lisis completado!\n\n';
        resultText += `üéØ PERFIL PRINCIPAL: ${res.data.result.main_profile} (${res.data.result.main_score}%)\n\n`;
        resultText += 'üìà ADECUACI√ìN POR PERFILES:\n';
        
        Object.entries(res.data.result.scores).forEach(([profile, score]) => {
          resultText += `‚Ä¢ ${profile}: ${(score * 100).toFixed(1)}%\n`;
        });
        
        resultText += '\nüìé ENLACES DE DESCARGA:\n';
        if (res.data.pdf_url) {
          resultText += `üìÑ PDF: ${res.data.pdf_url}\n`;
        }
        if (res.data.json_url) {
          resultText += `üìä JSON: ${res.data.json_url}\n`;
        }
        
        if (!res.data.pdf_url && !res.data.json_url) {
          resultText += '‚ö†Ô∏è Los archivos no se subieron a Dropbox. Verifica la configuraci√≥n.\n';
        }
        
        resultText += `\nüïê Fecha: ${new Date().toLocaleString()}`;

        out.innerText = resultText;

      } catch (e) {
        out.innerText = '‚ùå Error en el an√°lisis:\n' + e.toString() + 
                       '\n\nüîß Soluci√≥n:\n' +
                       '1. Aseg√∫rate de que el backend est√© ejecut√°ndose\n' +
                       '2. Verifica que el puerto 8000 est√© disponible\n' +
                       '3. Revisa la conexi√≥n a internet';
        console.error('Error completo:', e);
      } finally {
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>